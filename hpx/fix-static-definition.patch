diff --git a/cmake/HPX_CompilerFlagsTargets.cmake b/cmake/HPX_CompilerFlagsTargets.cmake
index 5bf4649..0912503 100644
--- a/cmake/HPX_CompilerFlagsTargets.cmake	
+++ b/cmake/HPX_CompilerFlagsTargets.cmake
@@ -15,14 +15,11 @@ target_compile_features(hpx_public_flags INTERFACE cxx_std_${HPX_CXX_STANDARD})
 
 # Set other flags that should always be set
 
-# HPX_DEBUG must be set without a generator expression as it determines ABI
-# compatibility. Projects in Release mode using HPX in Debug mode must have
-# HPX_DEBUG set, and projects in Debug mode using HPX in Release mode must not
-# have HPX_DEBUG set. HPX_DEBUG must also not be set by projects using HPX.
-if(${CMAKE_BUILD_TYPE} STREQUAL "Debug")
-  target_compile_definitions(hpx_private_flags INTERFACE HPX_DEBUG)
-  target_compile_definitions(hpx_public_flags INTERFACE HPX_DEBUG)
-endif()
+target_compile_definitions(hpx_private_flags INTERFACE $<$<CONFIG:DEBUG>:HPX_DEBUG>)
+target_compile_definitions(hpx_public_flags INTERFACE $<$<CONFIG:DEBUG>:HPX_DEBUG>)
+#target_compile_definitions(hpx_private_flags INTERFACE $<GENEX_EVAL:$<$<BOOL:HPX_WITH_STATIC_LINKING>:HPX_HAVE_STATIC_LINKING>>)
+#target_compile_definitions(hpx_public_flags INTERFACE $<GENEX_EVAL:$<$<BOOL:HPX_WITH_STATIC_LINKING>:HPX_HAVE_STATIC_LINKING>>)
+
 
 target_compile_definitions(
   hpx_private_flags
diff --git a/cmake/HPX_AddLibrary.cmake b/cmake/HPX_AddLibrary.cmake
index 3ebd99d..bd0d2d4 100644
--- a/cmake/HPX_AddLibrary.cmake	
+++ b/cmake/HPX_AddLibrary.cmake
@@ -235,6 +234,10 @@ function(add_hpx_library name)
     ${name} ${${name}_linktype} ${exclude_from_all} ${${name}_SOURCES}
             ${${name}_HEADERS} ${${name}_AUXILIARY}
   )
+  if(${name}_linktype STREQUAL "STATIC")
+    #target_compile_definitions(${name} PRIVATE HPX_HAVE_STATIC_LINKING)
+    #target_compile_definitions(${name} INTERFACE $<INSTALL_INTERFACE:HPX_HAVE_STATIC_LINKING>)
+  endif()
 
   if(NOT ${${name}_HEADER_ROOT} STREQUAL ".")
     target_include_directories(
diff --git a/libs/core/lock_registration/include/hpx/lock_registration/detail/register_locks.hpp b/libs/core/lock_registration/include/hpx/lock_registration/detail/register_locks.hpp
index 0b0faea..47772b9 100644
--- a/libs/core/lock_registration/include/hpx/lock_registration/detail/register_locks.hpp	
+++ b/libs/core/lock_registration/include/hpx/lock_registration/detail/register_locks.hpp
@@ -31,7 +31,7 @@ namespace hpx { namespace util {
     // Always provide function exports, which guarantees ABI compatibility of
     // Debug and Release builds.
 
-#if defined(HPX_HAVE_VERIFY_LOCKS) || defined(HPX_CORE_EXPORTS)
+#if defined(HPX_HAVE_VERIFY_LOCKS) || defined(HPX_CORE_EXPORTS)
 
     namespace detail {
 
diff --git a/libs/core/config/include/hpx/config/export_definitions.hpp b/libs/core/config/include/hpx/config/export_definitions.hpp
index d26fb88..2efd4dd 100644
--- a/libs/core/config/include/hpx/config/export_definitions.hpp	
+++ b/libs/core/config/include/hpx/config/export_definitions.hpp
@@ -17,7 +17,7 @@
 
 // clang-format off
 #if defined(_WIN32) || defined(__WIN32__) || defined(WIN32)
-#if !defined(HPX_MODULE_STATIC_LINKING)
+#if !defined(HPX_MODULE_STATIC_LINKING) && !defined(HPX_HAVE_STATIC_LINKING)
 # define HPX_SYMBOL_EXPORT      __declspec(dllexport)
 # define HPX_SYMBOL_IMPORT      __declspec(dllimport)
 # define HPX_SYMBOL_INTERNAL    /* empty */
